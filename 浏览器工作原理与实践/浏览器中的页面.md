# 浏览器中的页面



## 开发者工具

### 资源时间线

<img src=".\images\单个文件的时间线.webp" style="zoom:50%;" />

1. Queuing：排队时间。浏览器发送请求，一些原因导致无法立即执行，需要排队处理。
   1. 页面中资源的优先级；如：CSS、HTML、JS 等是核心文件，优先级高，图片、视频此类资源不是核心资源，优先级低。
   2. 浏览器为每个域名最多维护6个 TCP 连接。
   3. 网络进程在为数据分配磁盘空间时，新的 HTTP 请求也需要短暂的等待磁盘分配结束
2. Stalled：停滞；某些原因导致连接过程推迟。
3.  Initial connection/SSL ：和服务器建立连接的阶段，包含建立 TCP 连接所花费的时间 和 SSL 握手时间
4. Request sent 阶段：网络进程准备请求数据将其发送给网络；这个阶段通常非常快，因为只需要把浏览器缓冲区的数据发送出去即可，无需判断服务器是否接收到。
5. Waiting（TTFB）：第一字节时间。是反应服务端响应速度的重要指标；对服务器而言，TTFB 时间越短，说明服务器响应越快。
6. Content Download 阶段：第一字节时间到接收到全部响应数据所用时间



### 优化时间线上耗时项

1. Queuing 阶段：域名分片或者站点升级 HTTP2
2. TTFB 阶段：可能原因：
   1. 服务器生成页面数据的时间过久：提高服务器的处理速度，如缓存
   2. 网络原因：使用 CDN 缓存静态文件
   3. 发送请求头时带上多余的用户信息：尽可能减少不必要的 Cookie 数据信息
3. Content Download 阶段：可能是字节树过多导致，减少文件大小，如压缩、去除不必要的注释等





## JS 是如何影响 DOM 树构建？

### 什么是 DOM

渲染引擎无法自己理解 HTML 文件字节流，需要将其转化为渲染引擎能够理解的内部结构，这个结构就是 DOM。DOM是表述 HTML 的内部数据结构，会将 Web 页面和 JS 脚本连接起来，并过滤一些不安全的内容

- 页面视角：DOM 是生成页面的基础数据结构
- JS脚本视角：DOM 提供给 JS 脚本操作的接口，使其可以对 DOM 结构进行访问、修改
- 安全视角：DOM 是一道安全防护线，一些不安全的内容在 DOM 解析阶段就被拒之门外



### DOM 树如何生成

HTML 解析器（HTMLParser）：将 HTML 字节流转换为 DOM 结构

HTML 解析器：网络进程加载多少数据，便会解析多少数据；不是等整个文档加载完成再解析。通过网络进程和渲染进程的共享数据通道。



1. 分词器将字节流转为换 Token（Token 栈结构）
2. 将 Token 解析为 DOM 节点
3. 将 DOM 节点添加到 DOM 树中